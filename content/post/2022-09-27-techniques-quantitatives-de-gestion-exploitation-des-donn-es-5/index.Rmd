---
title: 'Techniques Quantitatives de Gestion : exploitation des données (5)'
author: Ludovic Vigneron
date: '2022-09-27'
categories:
  - Cours
  - R
  - TQG
  - Finance
tags:
  - Cours
  - Exercice
  - R
  - TQG
---

**Pour ce dernier post de la série consacrée au td de TQG, nous allons nous intéresser à ce qu'on appel l'effet lundi. Il s'agit de la propension qu'ont (qu'avaient?) les marchés actions à présenter des rendements moyens plus faibles les lundi que les autres jours de la semaine (Cross, 1973[^1]; French, 1980[^2]; Gibbons-Hess, 1981 [^3]; et bien d'autres à la suite...). Le données utilisées sont issues de CRPS, une base qui a la particularité de conserver les titres éteins et donc de permettre d'éviter le biais du survivant (conclusion à tord parce que l'on observe qu'une partie de la réalité d'un phénomène, celle des seuls survivants). Elles concernent uniquement les titres côtés sur les marchés américains. Nous allons utiliser la régression linéaire sur variable binaire (dummy) pour test l'hypothèse de rendements différents des autres jours les lundi.**

Pour commencer, comme à chaque fois, chargeons les packages que nous allons mobiliser.

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
```

Pour ce qui est des données, vous pouvez les télécharger [ici](monday_data.csv). N'oubliez pas de les mettre dans votre dossier de travail. Cela facilite l'adressage pour l'importation des données dans R. Réalisons-la avec la fonction **read_csv()**.

```{r}
dat <- read_csv("monday_data.csv")
```

Ceci fait. On peut regarder ce que l'on a comme information. Utilisons-la fonction **glimpse()**.

```{r}
glimpse(dat)
```

On a une indication de date (YYYMMDD), différents indices de marché, une variable année (YYYY) et une variable indiquant le jour de la semaine (day). L'ensemble est au format double.

Créons une variable exprimant la date dans un format compris comme une date. Pour cela, utilisons la fonction **ymd()** du package *lubridate*. A partir de cette nouvelle variable, nous pouvons créer la variable jours qui indique le jours de la semaine de la date considéré. Cela nous permettra de vérifier que la valeur 1 de day correspond bien au lundi. Pour cela, utilisons la fonction **wday()** (qui encore une fois est issue de *lubridate*).

```{r}
dat<-dat %>% mutate(date=ymd(YYYYMMDD),
                     jours=wday(date,week_start=1,label=TRUE,abbr=FALSE))
head(dat)[,8:10]
```

La valeur 1 de day correspond bien au lundi. Codons une variable binaire prenant la valeur TRUE (1) si day égale 1 (lundi) et FALSE (0) dans le cas contraire. Appelons la Monday_bin.

```{r}
dat <- dat %>% mutate(Monday_bin=day==1)
```

Limitons nous pour la suite au premier indice présenté VWID (vous pouvez répliquer ce qui suit avec les autres. Cela peut être un bon exercice. Les résultat seront qualitativement les mêmes). 

Commençons par une rapide représentation graphe des rendements de l'indice les lundi contre l'ensemble des autres jours. Marquons en rouge la moyenne globale des rendements et en bleu celle des seuls lundi et celle des autres jours.

```{r}
ggplot(data=dat,aes(x=Monday_bin,y=VWID))+
  geom_point()+
  geom_hline(yintercept=mean(dat$VWID),color='red',
             linetype='dashed')+
  geom_point(aes(y=mean(filter(dat,Monday_bin==TRUE)$VWID),x=TRUE),
             color='blue')+
  geom_point(aes(y=mean(filter(dat,Monday_bin==FALSE)$VWID),x=FALSE),
             color='blue')+
    theme_minimal()
```

On peut voir que les deux distributions ne se superposent pas complément. Les rendements du lundi apparaissent légèrement plus petits que ceux des autres jours. Néanmoins, les choses peuvent être plus compliquées. Réalisons un test de différence de moyenne pour avoir une image plus nette.

```{r}
round(data.frame(moy_tot=mean(dat$VWID),
                  moy_lundi=mean(filter(dat,Monday_bin==TRUE)$VWID),
                  moy_aut_jours=mean(filter(dat,Monday_bin==FALSE)$VWID),
                  t_stat=t.test(VWID~Monday_bin,data=dat)$statistic,
                  p_val=t.test(VWID~Monday_bin,data=dat)$p.value),
      digits=7)
```

L'hypothèse H0 d'égalité des moyennes des rendements entre les lundi et les autres jours est clairement rejetée. Voyons si on aboutit à la même conclusion sur la base d'une régression simple. 

```{r}
reg_m<-lm(VWID~Monday_bin,data=dat)
summary(reg_m)
```

Le coefficient associé aux lundi est négatif et statistiquement significatif ce qui va dans le sens ce que l'on a vue avec le test de différence de moyennes (bon ce n'est pas une surprise mais...). On peut à partir du modèle sortir l'intervalle de confiance du coefficient avec **confint()**.

```{r}
confint(reg_m,parm=2,level=0.95)
```

Sur tout l'intervalle à 95%, le coefficient est négatif. Les rendements des lundi sont plus petits dans les rendements des autres jours.

On peut retrouver les moyennes des groupes à partir des coefficients de régression. On a ainsi:

```{r}
round(data.frame(rend_aut_jr=coef(reg_m)[1] %>% unname(),
           rend_lundi=sum(coef(reg_m))),
      digits=7)
```

Voyons maintenant si cet effet lundi est toujours présent aprés les années 90. Pour cela, commençons par créer une variable marquant les observations post 1990.

```{r}
dat<-dat %>% mutate(post90=YYYY>=1990)
```

Réalisons le test de différence de moyenne sur la base réduite.

```{r}
dat_90<-filter(dat,post90==TRUE)
round(data.frame(moy_tot=mean(dat_90$VWID),
                  moy_lundi=mean(filter(dat_90,Monday_bin==TRUE)$VWID),
                  moy_aut_jours=
                   mean(filter(dat_90,Monday_bin==FALSE)$VWID),
                  t_stat=t.test(VWID~Monday_bin,data=dat_90)$statistic,
                  p_val=t.test(VWID~Monday_bin,data=dat_90)$p.value),
      digits=7)
```

La différence entre les deux moyennes n'est plus statistiquement significative. La p value du test est trop élevée pour que l'on rejette H0 (égalité des moyennes) à un niveau de confiance raisonnable (90%,95%,99%).

Cette absence de différence se voit bien sur le graphe du nuage de points des rendements sur les deux groupes d'observations (lundi vs autres jours).

```{r}
ggplot(data=dat_90,aes(x=Monday_bin,y=VWID))+
  geom_point()+
  geom_hline(yintercept=mean(dat_90$VWID),color='red',linetype='dashed')+
  geom_point(aes(y=mean(filter(dat_90,Monday_bin==TRUE)$VWID),x=TRUE),
             color='blue')+
  geom_point(aes(y=mean(filter(dat_90,Monday_bin==FALSE)$VWID),x=FALSE),
             color='blue')+
  theme_minimal()
```

Réalisons à nouveau le test au travers d'une régression simple.

```{r}
reg_m90<-lm(VWID~Monday_bin,data=dat_90)
summary(reg_m90)
```

Le coefficient de la variable marquant les lundi n'est pas significativement différent de zéro. L'effet lundi ne semble plus être présent après 1990.

Encore une fois, on peut retrouver les moyennes des groupes à partir des coefficients de la régression.

```{r}
round(data.frame(rend_aut_jr=coef(reg_m90)[1] %>% unname(),
           rend_lundi=sum(coef(reg_m90))),
      digits=7)
```

Une autre façon de procéder pourrait consister à régresser l’interaction entre la variable marquant les lundi et celle marquant la période post 1990.  

```{r}
reg_m90alt<-lm(VWID~Monday_bin*post90,data=dat)
summary(reg_m90alt)
```

On obtient trois coefficients en plus de la constante. On peut à partir de ces indications retrouver les moyennes des rendements sur les groupes d'observations constitué à partir à partir des deux variables. 


```{r}
round(data.frame(
        aut_jrs_avant90=coef(reg_m90alt)[1] %>% unname(),
        lundi_avant90=sum(coef(reg_m90alt)[1:2]),
        aut_jrs_post90=sum(coef(reg_m90alt)[c(1,3)]),
        lundi_post90=sum(coef(reg_m90alt))),digits=7)
```

Un des résultats important pour la compréhension du phénomène mis en évidence par la littérature (voir Doyle et Chen, 2009[^4]) est que l'intensité de celui-ci serait lié à la performance des marchés la semaine précédent le lundi considéré. Testons nous-même cette hypothèse. Introduisons dans notre base générale une variable reflétant sur les lundi la performance sur la semaine précédente (il s'agit d'une variable d’interaction Monday_bin et performance sur la semaine précédente). 

```{r}
dat_twi<-dat %>% select(VWID,date,YYYY,jours,Monday_bin) %>% 
  arrange(date) %>%
  mutate(week=week(date-2)) %>% 
  group_by(YYYY,week) %>% 
  mutate(moy_we_r=mean(VWID)) %>% 
  ungroup() %>% 
  mutate(monday_perf_l=Monday_bin*lag(moy_we_r))
```

Régression les performances de l'indice sur la variable lundi et notre nouvelle variable (d'intéraction). Si la performance sur la semaine précédente guide la performe du lundi, le coefficient de la nouvelle variable devrait être positif.

```{r}
reg_m_tw<-lm(VWID~Monday_bin+monday_perf_l,data=dat_twi)
summary(reg_m_tw)
```

Le coefficient de la variable d’intéraction est positif et statistiquement significatif. Il apparaît que l'effet lundi est bien corrélé avec la performance de la semaine précédente. Pour illustrer l'ensemble retrouvons les moyennes à partir des coefficients. Commençons par calculer la performance moyenne des semaines précédentes.

```{r}
moy_perf_l<-mean(dat_twi$monday_perf_l[dat_twi$monday_perf_l!=0],
                 na.rm=TRUE)
```

Appliquons nos coefficients pour obtenir nos performances.

```{r}
round(data.frame(
        aut_jrs=coef(reg_m_tw)[1] %>% unname(),
        lundi_perf0=sum(coef(reg_m_tw)[1:2]),
        lundi_perfM=
          sum(coef(reg_m_tw)[1:2])+unname(coef(reg_m_tw)[3]*moy_perf_l)),
        digits=7)
```

Voyons si le lien perdure après 1990.

```{r}
reg_m_twr<-lm(VWID~Monday_bin+monday_perf_l,
             data=filter(dat_twi,YYYY>=1990))
summary(reg_m_twr)
```

Recalculons la performance moyenne des semaines précédentes sur l'échantillon limité à la période post 1990.

```{r}
moy_perf_lr<-mean(filter(dat_twi,
                        YYYY>=1990)$monday_perf_l[dat_twi$monday_perf_l!=0],
                 na.rm=TRUE)
```

Cela nous permet de ré-estimer les performances moyennes pour les groupes désignés.

```{r}
round(data.frame(
        aut_jrs=coef(reg_m_twr)[1] %>% unname(),
        lundi_perf0=sum(coef(reg_m_twr)[1:2]),
        lundi_perfM=
          sum(coef(reg_m_twr)[1:2])+unname(coef(reg_m_twr)[3]*moy_perf_lr)),
        digits=7)
```

Je vous laisse interpréter ces nouveaux éléments... Et, aux étudiants qui par hasard auraient lu cette série de post, je souhaites bonne chance pour l'examen.

----

[^1]: Cross, F., 1973, The behavior of stock prices on Fridays and Mondays, Financial Analysts Journal, 29, Nov.-Dec., 67-69.

[^2]: French, K., 1980, Stock returns and the weekend effect, Journal of Financial Economics, 8, March, 55-69.

[^3]: Gibbons, M. and P. Hess, 1981, Day of the week effects and asset returns, Journal of Business, 54, Oct., 579-596. 

[^4]: Doyle, J. and C. Chen, 2009, The wandering weekday effect in major stock markets, Journal of Banking and Finance, 33, 1388-1399.


